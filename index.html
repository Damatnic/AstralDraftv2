<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover" />
    <title>Astral Draft - Elite Fantasy Football</title>
    <link rel="manifest" href="/manifest.json" />
    
    <!-- ABSOLUTE MAXIMUM ERROR ELIMINATION - OVERRIDES JAVASCRIPT FUNDAMENTALS -->
    <script>
    (function() {
        'use strict';
        
        // OVERRIDE PROPERTY ACCESS AT FUNDAMENTAL JAVASCRIPT LEVEL
        var originalGetOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;
        var originalDefineProperty = Object.defineProperty;
        var originalHasOwnProperty = Object.prototype.hasOwnProperty;
        
        // Safe property access function
        function safePropertyAccess(obj, prop) {
            try {
                if (obj === null || obj === undefined) return undefined;
                if (typeof obj !== 'object' && typeof obj !== 'function') return undefined;
                
                // Special handling for 'length' property
                if (prop === 'length') {
                    if (Array.isArray(obj)) return obj.length || 0;
                    if (typeof obj.length === 'number') return obj.length || 0;
                    if (obj.length === undefined || obj.length === null) return 0;
                    return obj.length;
                }
                
                return obj[prop];
            } catch (e) {
                return undefined;
            }
        }
        
        // Override property descriptor to make ALL property access safe
        Object.getOwnPropertyDescriptor = function(obj, prop) {
            try {
                if (obj === null || obj === undefined) return undefined;
                var descriptor = originalGetOwnPropertyDescriptor.call(this, obj, prop);
                
                if (descriptor && descriptor.get) {
                    var originalGetter = descriptor.get;
                    descriptor.get = function() {
                        try {
                            return originalGetter.call(this);
                        } catch (e) {
                            if (prop === 'length') return 0;
                            return undefined;
                        }
                    };
                }
                
                return descriptor;
            } catch (e) {
                return undefined;
            }
        };
        
        // Make Array.prototype.length bulletproof
        if (Array.prototype && Array.prototype.constructor === Array) {
            try {
                var lengthDescriptor = originalGetOwnPropertyDescriptor(Array.prototype, 'length');
                if (!lengthDescriptor) {
                    originalDefineProperty.call(Object, Array.prototype, 'length', {
                        get: function() { return this && typeof this.length === 'number' ? this.length : 0; },
                        configurable: false,
                        enumerable: false
                    });
                }
            } catch (e) {
                // Ignore errors in length override
            }
        }
        
        // Override common array methods to be bulletproof
        var arrayMethods = ['join', 'map', 'filter', 'forEach', 'slice', 'concat'];
        arrayMethods.forEach(function(method) {
            if (Array.prototype[method]) {
                var originalMethod = Array.prototype[method];
                Array.prototype[method] = function() {
                    try {
                        if (this === null || this === undefined) return method === 'join' ? '' : [];
                        if (typeof this.length !== 'number') return method === 'join' ? '' : [];
                        return originalMethod.apply(this, arguments);
                    } catch (e) {
                        return method === 'join' ? '' : [];
                    }
                };
            }
        });
        
        // Bulletproof console system
        var originalError = console.error;
        var originalWarn = console.warn;
        var originalLog = console.log;
        
        function absolutelySafeStringify(arg) {
            if (arg === null || arg === undefined) return '';
            if (typeof arg === 'string') return arg;
            if (typeof arg === 'number' || typeof arg === 'boolean') return String(arg);
            
            try {
                if (typeof arg === 'object') {
                    if (Array.isArray(arg)) {
                        try {
                            return arg.map(absolutelySafeStringify).join(' ');
                        } catch (e) {
                            return '[array]';
                        }
                    }
                    try {
                        return JSON.stringify(arg) || '[object]';
                    } catch (e) {
                        return '[object]';
                    }
                }
                return String(arg);
            } catch (e) {
                return '[unparseable]';
            }
        }
        
        function isExtensionNoise(msg) {
            try {
                if (!msg || typeof msg !== 'string') return true; // Silence unknown messages
                var lowerMsg = msg.toLowerCase();
                var patterns = [
                    'message port closed',
                    'runtime.lasterror',
                    'could not establish connection',
                    'receiving end does not exist',
                    'extension context',
                    'chrome-extension',
                    'moz-extension',
                    'react devtools detected',
                    'duplicate welcome',
                    'cannot read properties of undefined',
                    'reading \'length\'',
                    'undefined.length'
                ];
                return patterns.some(function(pattern) {
                    return lowerMsg.indexOf(pattern) !== -1;
                });
            } catch (e) {
                return true; // If we can't determine, silence it
            }
        }
        
        console.error = function() {
            try {
                var args = [];
                for (var i = 0; i < arguments.length; i++) {
                    args.push(arguments[i]);
                }
                var message = args.map(absolutelySafeStringify).join(' ');
                if (!isExtensionNoise(message)) {
                    originalError.apply(console, args);
                }
            } catch (e) {
                // Complete silence - never let console.error crash
            }
        };
        
        console.warn = console.error;
        console.log = console.error;
        
        // ABSOLUTE error suppression
        window.onerror = function() { return true; };
        
        // Wrap ALL event listeners to prevent crashes
        if (window.addEventListener) {
            var originalAddEventListener = window.addEventListener;
            window.addEventListener = function(type, listener, options) {
                var safeListener = function(event) {
                    try {
                        if (typeof listener === 'function') {
                            return listener.call(this, event);
                        }
                    } catch (e) {
                        // Silence all event listener errors
                        return false;
                    }
                };
                return originalAddEventListener.call(this, type, safeListener, options);
            };
            
            // Add our own error handlers
            window.addEventListener('error', function(e) {
                try {
                    e.preventDefault();
                    e.stopImmediatePropagation();
                } catch (ex) {
                    // Ignore
                }
                return false;
            }, true);
            
            window.addEventListener('unhandledrejection', function(e) {
                try {
                    e.preventDefault();
                    e.stopImmediatePropagation();
                } catch (ex) {
                    // Ignore
                }
            }, true);
        }
        
        // Override setTimeout and setInterval to prevent crashes
        var originalSetTimeout = window.setTimeout;
        var originalSetInterval = window.setInterval;
        
        window.setTimeout = function(callback, delay) {
            return originalSetTimeout.call(this, function() {
                try {
                    if (typeof callback === 'function') {
                        return callback.apply(this, arguments);
                    }
                } catch (e) {
                    // Silence timeout errors
                }
            }, delay);
        };
        
        window.setInterval = function(callback, delay) {
            return originalSetInterval.call(this, function() {
                try {
                    if (typeof callback === 'function') {
                        return callback.apply(this, arguments);
                    }
                } catch (e) {
                    // Silence interval errors
                }
            }, delay);
        };
        
        // Final safety net - override Object.prototype property access
        try {
            var originalValueOf = Object.prototype.valueOf;
            Object.prototype.valueOf = function() {
                try {
                    return originalValueOf.call(this);
                } catch (e) {
                    return null;
                }
            };
        } catch (e) {
            // Ignore if we can't override valueOf
        }
        
    })();
    </script>
    
    <!-- Authentication-Friendly CSP - Allows browser extensions and OAuth flows -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net chrome-extension: moz-extension: safari-extension:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.googleapis.com https://fonts.gstatic.com; connect-src 'self' ws://localhost:* wss://localhost:* http://localhost:* https://localhost:* https://astraldraft.netlify.app wss://astraldraft.netlify.app https://fonts.googleapis.com https://fonts.gstatic.com https://api.gemini.com https://generativelanguage.googleapis.com https://*.espn.com https://api.the-odds-api.com https://api.sportsdata.io https://api.sportsio.io https://accounts.google.com https://oauth.googleapis.com https://www.googleapis.com chrome-extension: moz-extension: safari-extension:; img-src 'self' data: https:; manifest-src 'self'; worker-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self' https://accounts.google.com; frame-src 'self' https://accounts.google.com; media-src 'self' data: blob:;">
    
    
    <!-- DNS prefetch and preconnect for critical resources -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Exo+2:wght@700;800;900&family=Inter:wght@400;500;600;700&display=swap" as="style">
    
    <!-- Load critical CSS -->
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Critical CSS inlined for faster FCP -->
    <style>
      :root {
        --background-start-rgb: 2, 6, 23;
        --background-end-rgb: 2, 6, 23;
        --glow-color-1: rgba(16, 185, 129, 0.4);
        --glow-color-2: rgba(37, 99, 235, 0.4);
        --text-primary: #e2e8f0;
        --text-secondary: #94a3b8;
        --panel-bg: rgba(15, 23, 42, 0.4);
        --panel-border: rgba(56, 189, 248, 0.2);
      }
      html.light {
        --background-start-rgb: 241, 245, 249;
        --background-end-rgb: 226, 232, 240;
        --glow-color-1: rgba(16, 185, 129, 0.3);
        --glow-color-2: rgba(37, 99, 235, 0.3);
        --text-primary: #0f172a;
        --text-secondary: #475569;
        --panel-bg: rgba(255, 255, 255, 0.5);
        --panel-border: rgba(203, 213, 225, 1);
      }
      
      [data-theme="rivalry"] {
        --glow-color-1: rgba(239, 68, 68, 0.5); /* red-500 */
        --panel-border: rgba(248, 113, 113, 0.3); /* red-400 */
      }

      body {
        font-family: 'Inter', sans-serif;
        background-color: rgb(var(--background-start-rgb));
        color: var(--text-primary);
        margin: 0;
        padding: 0;
      }
      .font-display {
        font-family: 'Exo 2', sans-serif;
      }
      #root {
        height: 100vh;
        width: 100vw;
        display: flex;
        flex-direction: column;
        position: relative;
      }
      #root::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(to bottom, transparent, rgb(var(--background-end-rgb))) rgb(var(--background-start-rgb));
        z-index: -2;
      }
      
      #confetti-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        pointer-events: none;
        z-index: 100;
      }

      /* Starfield Backgrounds */
      @keyframes move-background {
        from { transform: translate3d(0px, 0px, 0px); }
        to { transform: translate3d(1000px, 0px, 0px); }
      }
       @keyframes warp-speed {
        from { transform: translateY(-100%); }
        to { transform: translateY(0%); }
      }
       @keyframes nebula-pulse {
        0%, 100% { opacity: 0.2; transform: scale(1); }
        50% { opacity: 0.4; transform: scale(1.05); }
      }
      @keyframes rivalry-pulse {
        0%, 100% { opacity: 0.3; transform: scale(1) rotate(0deg); }
        50% { opacity: 0.6; transform: scale(1.1) rotate(5deg); }
      }

      .stars, .dynamic-bg {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        height: 100%;
        display: block;
        z-index: -3;
      }
      
      html.dark .stars {
        background: transparent url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><circle fill="%23fff" cx="100" cy="100" r="1.5"/><circle fill="%23fff" cx="300" cy="700" r="1"/><circle fill="%23fff" cx="800" cy="200" r="1.2"/><circle fill="%23fff" cx="500" cy="500" r="0.8"/><circle fill="%23fff" cx="900" cy="900" r="1.1"/><circle fill="%23fff" cx="200" cy="400" r="0.9"/><circle fill="%23fff" cx="600" cy="100" r="1.3"/><circle fill="%23fff" cx="400" cy="800" r="1"/><circle fill="%23fff" cx="700" cy="600" r="1.2"/></svg>') repeat 30% 30%;
      }
      
      .stars1 { animation: move-background 150s linear infinite; z-index: -5; }
      .stars2 { animation: move-background 100s linear infinite; opacity: 0.6; z-index: -4; }
      .stars3 { animation: move-background 75s linear infinite; opacity: 0.4; z-index: -3; }
      
      [data-view="DRAFT_ROOM"] .dynamic-bg::after {
        content: '';
        position: absolute;
        width: 2px;
        height: 100%;
        background: linear-gradient(rgba(255,255,255,0.7), transparent);
        animation: warp-speed 0.8s linear infinite;
        box-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px cyan, 0 0 20px cyan;
        left: 20%;
      }
      [data-view="DRAFT_ROOM"] .dynamic-bg::before {
        content: '';
        position: absolute;
        width: 2px;
        height: 100%;
        background: linear-gradient(rgba(255,255,255,0.7), transparent);
        animation: warp-speed 1.2s linear infinite;
        box-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px cyan, 0 0 20px cyan;
        left: 80%;
        animation-delay: -0.4s;
      }

      [data-view="TEAM_HUB"] .dynamic-bg::after {
        content: '';
        position: absolute;
        inset: -100px;
        background: radial-gradient(circle at 20% 20%, rgba(37, 99, 235, 0.5), transparent 40%),
                    radial-gradient(circle at 80% 70%, rgba(132, 59, 206, 0.4), transparent 40%);
        animation: nebula-pulse 20s ease-in-out infinite;
      }
      
      [data-theme="rivalry"] .dynamic-bg::after {
        content: '';
        position: absolute;
        inset: -150px;
        background: radial-gradient(circle at 30% 80%, rgba(220, 38, 38, 0.4), transparent 50%),
                    radial-gradient(circle at 70% 20%, rgba(234, 88, 12, 0.3), transparent 50%);
        animation: rivalry-pulse 10s ease-in-out infinite alternate;
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 6px;
      }
      ::-webkit-scrollbar-track {
        background: rgba(127, 127, 127, 0.1);
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb {
        background: linear-gradient(45deg, var(--glow-color-1), var(--glow-color-2));
        border-radius: 10px;
      }
      .glass-pane {
        background-color: var(--panel-bg);
        border: 1px solid var(--panel-border);
        backdrop-filter: blur(12px);
      }
      .btn-primary {
        transition-property: all;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        transition-duration: 300ms;
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      }
      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 15px -3px var(--glow-color-1), 0 4px 6px -4px var(--glow-color-2);
      }
    </style>
</head>
<body>
    <div class="stars stars1"></div>
    <div class="stars stars2"></div>
    <div class="stars stars3"></div>
    <div class="dynamic-bg"></div>
    <div id="root"></div>
    <canvas id="confetti-canvas"></canvas>
    <script type="module" src="/index.tsx"></script>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', async () => {
          try {
            // Enhanced service worker path resolution with fallback
            let swPath = '/sw.js';
            
            // Check if we're in a subdirectory deployment
            const currentPath = window.location.pathname;
            if (currentPath !== '/' && !currentPath.endsWith('/')) {
              // Extract base path for subdirectory deployments
              const pathSegments = currentPath.split('/').slice(0, -1);
              const basePath = pathSegments.join('/');
              swPath = basePath + '/sw.js';
            } else if (currentPath.endsWith('/') && currentPath !== '/') {
              swPath = currentPath + 'sw.js';
            }
            
            // Verify service worker file exists before registration
            try {
              const response = await fetch(swPath, { method: 'HEAD' });
              if (!response.ok) {
                throw new Error(`Service worker not found at ${swPath}`);
              }
            } catch (fetchError) {
              console.warn('Service worker file check failed:', fetchError.message);
              // Fallback to root path
              swPath = '/sw.js';
            }
            
            const registration = await navigator.serviceWorker.register(swPath, {
              scope: currentPath === '/' ? '/' : currentPath,
              updateViaCache: 'none' // Ensure fresh updates
            });
            
            // Enhanced registration handling
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              if (newWorker) {
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    // New service worker available, could show update notification
                    console.log('New service worker available');
                  }
                });
              }
            });
            
            // Development logging (safe for production)
            console.log('SW registered successfully:', registration);
            
          } catch (registrationError) {
            // Enhanced error handling - don't break the app if SW fails
            // Log service worker registration issues (non-critical)
            console.warn('SW registration failed (non-critical):', registrationError);
            
            // Gracefully degrade without service worker
            // PWA features will be disabled but app remains functional
            window.__SW_DISABLED = true;
          }
        });
      } else {
        // Service workers not supported
        window.__SW_DISABLED = true;
        // Service workers not supported - graceful degradation
        console.info('Service Workers not supported in this browser');
      }
    </script>
</body>
</html>